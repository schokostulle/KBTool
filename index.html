<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Allianz Dashboard</title>
<style>
  :root {
    --bg: #f9fafb;
    --card: #ffffff;
    --border: #e5e7eb;
    --text: #111827;
    --accent: #2563eb;
    --accent-hover: #1d4ed8;
    --shadow: 0 3px 8px rgba(0,0,0,0.08);
    --radius: 12px;
  }
  body {
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 2rem;
  }
  h1 { font-size: 1.8rem; margin-bottom: 1rem; }
  h2 { font-size: 1.3rem; margin-bottom: .5rem; }
  .hidden { display: none; }

  /* Dashboard grid */
  .dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 1.2rem;
    text-align: center;
    cursor: pointer;
    transition: transform 0.15s ease;
  }
  .card:hover { transform: scale(1.03); background: #eef2ff; }

  button {
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius);
    padding: 8px 12px;
    cursor: pointer;
  }
  button:hover { background: var(--accent-hover); }

  /* Table */
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 1rem;
    border-radius: var(--radius);
    overflow: hidden;
  }
  th, td {
    border-bottom: 1px solid var(--border);
    padding: 8px 10px;
    text-align: left;
    font-size: 14px;
  }
  th { background: #f3f4f6; font-weight: 600; }

  /* Filter bar */
  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }
  .filter-bar select, .filter-bar input {
    padding: 5px 8px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
  }

  textarea {
    width: 100%;
    height: 120px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    padding: 8px;
  }

  .back-btn {
    margin-bottom: 1rem;
    background: #6b7280;
  }
</style>
</head>
<body>

<h1>Allianz Dashboard</h1>

<!-- === DASHBOARD === -->
<div id="dashboard">
  <div class="dashboard">
    <div class="card" onclick="showPage('csvView')">üìú CSV-Datenbasis</div>
    <div class="card" onclick="showPage('inselView')">üèù Insel√ºbersicht</div>
    <div class="card" onclick="showPage('statsView')">üìà Allianz-Statistik</div>
    <div class="card" onclick="showPage('reportView')">‚öîÔ∏è Kampfberichte</div>
  </div>

  <h2>CSV hochladen</h2>
  <input type="file" id="csvUpload" accept=".csv" />
  <button onclick="uploadCSV()">CSV laden</button>
  <p style="margin-top:.5rem; font-size:13px; color:#6b7280;">
    Hinweis: CSV-Spalten = Ozean, Inselgruppe, Insel, Inselname, Spieler ID, Spielername, Allianz ID, Allianz K√ºrzel, Allianzname, Punkte
  </p>
</div>

<!-- === CSV Daten === -->
<div id="csvView" class="hidden">
  <button class="back-btn" onclick="showPage('dashboard')">‚¨ÖÔ∏è Zur√ºck</button>
  <h2>CSV Datenbasis</h2>
  <div id="csvTable">Noch keine CSV geladen.</div>
</div>

<!-- === Insel√ºbersicht === -->
<div id="inselView" class="hidden">
  <button class="back-btn" onclick="showPage('dashboard')">‚¨ÖÔ∏è Zur√ºck</button>
  <h2>üèù Insel√ºbersicht</h2>

  <div class="filter-bar">
    <select id="filterAllianz"><option value="">Allianz (alle)</option></select>
    <select id="filterSpieler"><option value="">Spieler (alle)</option></select>
    <input type="number" id="filterOz" placeholder="Ozean" min="1" />
    <button onclick="applyInselFilter()">Filtern</button>
    <button onclick="resetInselFilter()">Zur√ºcksetzen</button>
  </div>

  <div id="inselTable"></div>
</div>

<!-- === Allianz Statistik === -->
<div id="statsView" class="hidden">
  <button class="back-btn" onclick="showPage('dashboard')">‚¨ÖÔ∏è Zur√ºck</button>
  <h2>üìà Allianz-Statistik</h2>
  <div id="statsTable"></div>
</div>

<!-- === Kampfberichte === -->
<div id="reportView" class="hidden">
  <button class="back-btn" onclick="showPage('dashboard')">‚¨ÖÔ∏è Zur√ºck</button>
  <h2>‚öîÔ∏è Kampfberichte-Import</h2>
  <p>F√ºge hier Kampfberichte aus dem Spiel ein (Textblock).</p>
  <textarea id="reportInput" placeholder="Kampfbericht hier einf√ºgen..."></textarea>
  <button onclick="parseReport()">Importieren</button>
  <div id="reportResult"></div>
</div>

<script>
  let csvData = [];

  function showPage(page) {
    document.querySelectorAll("#dashboard, #csvView, #inselView, #statsView, #reportView")
      .forEach(el => el.classList.add("hidden"));
    document.getElementById(page).classList.remove("hidden");
  }

  function uploadCSV() {
    const file = document.getElementById("csvUpload").files[0];
    if (!file) return alert("Bitte CSV ausw√§hlen!");
    const reader = new FileReader();
    reader.onload = e => {
      const lines = e.target.result.trim().split("\n").map(l => l.trim());
      csvData = lines.map(line => {
        const v = line.split(";").map(x => x.replace(/^"|"$/g, '').trim());
        return {
          Ozean: v[0],
          Inselgruppe: v[1],
          Insel: v[2],
          Inselname: v[3],
          "Spieler ID": v[4],
          Spielername: v[5],
          "Allianz ID": v[6],
          "Allianz K√ºrzel": v[7],
          Allianzname: v[8],
          Punkte: parseInt(v[9] || "0")
        };
      });
      renderCSVTable();
      renderStatsTable();
      fillFilterOptions();
      alert("CSV erfolgreich geladen!");
    };
    reader.readAsText(file);
  }

  // CSV Tabelle
  function renderCSVTable() {
    const div = document.getElementById("csvTable");
    let html = "<table><thead><tr><th>Oz</th><th>IG</th><th>I</th><th>Inselname</th><th>Spieler</th><th>Allianz</th><th>Punkte</th></tr></thead><tbody>";
    csvData.forEach(r => {
      html += `<tr><td>${r.Ozean}</td><td>${r.Inselgruppe}</td><td>${r.Insel}</td><td>${r.Inselname}</td><td>${r.Spielername}</td><td>${r.Allianzname}</td><td>${r.Punkte}</td></tr>`;
    });
    html += "</tbody></table>";
    div.innerHTML = html;
  }

  // Insel√ºbersicht-Filter bef√ºllen
  function fillFilterOptions() {
    const allianzen = [...new Set(csvData.map(r => r.Allianzname))].sort();
    const spieler = [...new Set(csvData.map(r => r.Spielername))].sort();

    const aSel = document.getElementById("filterAllianz");
    const sSel = document.getElementById("filterSpieler");
    aSel.innerHTML = '<option value="">Allianz (alle)</option>';
    sSel.innerHTML = '<option value="">Spieler (alle)</option>';
    allianzen.forEach(a => aSel.innerHTML += `<option>${a}</option>`);
    spieler.forEach(s => sSel.innerHTML += `<option>${s}</option>`);

    renderInselTable(csvData);
  }

  // Insel√ºbersicht anzeigen
  function renderInselTable(data) {
    const div = document.getElementById("inselTable");
    if (!data.length) { div.innerHTML = "Keine Eintr√§ge."; return; }
    let html = "<table><thead><tr><th>Oz</th><th>IG</th><th>I</th><th>Inselname</th><th>Spieler</th><th>Allianz</th><th>Punkte</th></tr></thead><tbody>";
    data.forEach(r => {
      html += `<tr><td>${r.Ozean}</td><td>${r.Inselgruppe}</td><td>${r.Insel}</td><td>${r.Inselname}</td><td>${r.Spielername}</td><td>${r.Allianzname}</td><td>${r.Punkte}</td></tr>`;
    });
    html += "</tbody></table>";
    div.innerHTML = html;
  }

  // Insel√ºbersicht: Filter anwenden
  function applyInselFilter() {
    const a = document.getElementById("filterAllianz").value;
    const s = document.getElementById("filterSpieler").value;
    const o = document.getElementById("filterOz").value;
    const filtered = csvData.filter(r =>
      (!a || r.Allianzname === a) &&
      (!s || r.Spielername === s) &&
      (!o || r.Ozean === o)
    );
    renderInselTable(filtered);
  }
  function resetInselFilter() {
    document.getElementById("filterAllianz").value = "";
    document.getElementById("filterSpieler").value = "";
    document.getElementById("filterOz").value = "";
    renderInselTable(csvData);
  }

  // Allianzstatistik
  function renderStatsTable() {
    if (!csvData.length) return;
    const div = document.getElementById("statsTable");
    const grouped = {};
    csvData.forEach(r => {
      const a = r.Allianzname;
      if (!grouped[a]) grouped[a] = { Allianz: a, Inseln: 0, Spieler: new Set(), Punkte: 0 };
      grouped[a].Inseln++;
      grouped[a].Punkte += r.Punkte;
      grouped[a].Spieler.add(r.Spielername);
    });
    const rows = Object.values(grouped).map(g => ({
      Allianz: g.Allianz,
      Inseln: g.Inseln,
      Spieler: g.Spieler.size,
      Punkte: g.Punkte,
      Durchschnitt: Math.round(g.Punkte / g.Spieler.size)
    }));
    let html = "<table><thead><tr><th>Allianz</th><th>Inseln</th><th>Spieler</th><th>Punkte</th><th>√ò Punkte / Spieler</th></tr></thead><tbody>";
    rows.forEach(r => {
      html += `<tr><td>${r.Allianz}</td><td>${r.Inseln}</td><td>${r.Spieler}</td><td>${r.Punkte}</td><td>${r.Durchschnitt}</td></tr>`;
    });
    html += "</tbody></table>";
    div.innerHTML = html;
  }

  // Kampfberichte-Import (Grundfunktion)
  function parseReport() {
    const text = document.getElementById("reportInput").value.trim();
    if (!text) return alert("Bitte einen Kampfbericht einf√ºgen!");
    const lines = text.split("\n").map(l => l.trim());
    let result = "<h3>Erkannte Daten:</h3><ul>";
    lines.forEach(l => {
      if (/vom\s+\d{2}\.\d{2}\.\d{4}/i.test(l)) result += `<li><b>Datum:</b> ${l}</li>`;
      else if (/Angreifer/i.test(l)) result += `<li><b>${l}</b></li>`;
      else if (/Verteidiger/i.test(l)) result += `<li><b>${l}</b></li>`;
      else if (/Gepl√ºnderte Rohstoffe/i.test(l)) result += `<li><b>${l}</b></li>`;
    });
    result += "</ul>";
    document.getElementById("reportResult").innerHTML = result;
  }
</script>
</body>
</html>