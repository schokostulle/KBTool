<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bullfrog Command – Anmeldung</title>
  <link rel="stylesheet" href="./css/stylesheet.css" />
</head>

<body class="dark-theme">
  <header class="header">
    <h1>⚓ Bullfrog Command</h1>
  </header>

  <main>
    <!-- LOGIN -->
    <section class="auth-section" id="loginContainer">
      <div class="auth-box">
        <h2>Login</h2>
        <p>Melde dich mit deiner @bullfrog.fake Adresse an</p>

        <input type="email" id="loginEmail" placeholder="E-Mail" class="auth-input" />
        <input type="password" id="loginPassword" placeholder="Passwort" class="auth-input" />
        <button id="loginBtn" class="auth-btn">Einloggen</button>

        <p class="toggle-text">
          Noch kein Konto?
          <span id="showRegister" class="toggle-link">Jetzt registrieren ⚔️</span>
        </p>

        <div id="loginMsg" class="info-box hidden"></div>
      </div>
    </section>

    <!-- REGISTRIERUNG -->
    <section class="auth-section hidden" id="registerContainer">
      <div class="auth-box">
        <h2>Registrierung</h2>
        <p>Erstelle ein Konto mit deiner @bullfrog.fake E-Mail</p>

        <input type="email" id="regEmail" placeholder="E-Mail" class="auth-input" />
        <input type="password" id="regPassword" placeholder="Passwort" class="auth-input" />
        <button id="registerBtn" class="auth-btn">Registrieren</button>

        <p class="toggle-text">
          Schon registriert?
          <span id="showLogin" class="toggle-link">Zum Login ⚓</span>
        </p>

        <div id="registerMsg" class="info-box hidden"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>⚓ Bullfrog Fleet Command – Gemeinschaft der Seefahrer</p>
  </footer>

  <!-- Supabase + JS -->
  <script type="module">
    import { supabase } from './js/supabase.js';

    // Elemente
    const loginContainer = document.getElementById('loginContainer');
    const registerContainer = document.getElementById('registerContainer');
    const loginMsg = document.getElementById('loginMsg');
    const registerMsg = document.getElementById('registerMsg');

    // Umschalten Login/Registrierung
    document.getElementById('showRegister').addEventListener('click', () => {
      loginContainer.classList.add('hidden');
      registerContainer.classList.remove('hidden');
    });
    document.getElementById('showLogin').addEventListener('click', () => {
      registerContainer.classList.add('hidden');
      loginContainer.classList.remove('hidden');
    });

    // Login
    document.getElementById('loginBtn').addEventListener('click', async () => {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value.trim();
      loginMsg.classList.remove('hidden');
      loginMsg.textContent = '⏳ Anmeldung läuft...';

      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        loginMsg.textContent = `❌ Fehler: ${error.message}`;
      } else {
        loginMsg.textContent = '✅ Willkommen zurück, Kommandant!';
        setTimeout(() => (window.location.href = './dashboard.html'), 800);
      }
    });

    // Registrierung
    document.getElementById('registerBtn').addEventListener('click', async () => {
      const email = document.getElementById('regEmail').value.trim();
      const password = document.getElementById('regPassword').value.trim();
      registerMsg.classList.remove('hidden');
      registerMsg.textContent = '⚓ Registrierung läuft...';

      if (!email.endsWith('@bullfrog.fake')) {
        registerMsg.textContent = '❌ Bitte nutze eine @bullfrog.fake E-Mail-Adresse';
        return;
      }

      const { error } = await supabase.auth.signUp({ email, password });
      if (error) {
        registerMsg.textContent = `❌ Fehler: ${error.message}`;
      } else {
        registerMsg.textContent = '✅ Konto erstellt! Du kannst dich jetzt einloggen.';
        setTimeout(() => {
          registerContainer.classList.add('hidden');
          loginContainer.classList.remove('hidden');
        }, 1200);
      }
    });

    // Automatisches Weiterleiten, falls eingeloggt
    (async () => {
      const { data } = await supabase.auth.getSession();
      if (data?.session) window.location.href = './dashboard.html';
    })();
  </script>
</body>
</html>