<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard – Orden der Ersten Seefahrt</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="ocean-bg" aria-hidden="true"></div>
  <main class="dashboard-shell">
    <aside class="sidebar">
      <h2 class="logo">⚓ Crewmenü</h2>
      <nav>
        <ul>
          <li><a href="dashboard.html" class="active">🏠 Übersicht</a></li>
          <li><a href="mitglieder.html">👥 Mitglieder</a></li>
          <li><button id="logout-btn" class="btn small">🚪 Abmelden</button></li>
        </ul>
      </nav>
    </aside>

    <section class="main-content">
      <header>
        <h1>Willkommen an Bord!</h1>
        <p class="subtitle">Neuigkeiten und Ankündigungen der Flotte</p>
      </header>

      <article class="news">
        <h2>⚔️ Ankündigungen</h2>
        <ul id="announcements">
          <li><strong>27. Oktober 2025:</strong> Die neue Navigationskarte wurde veröffentlicht.</li>
        </ul>
      </article>

      <article class="quick">
        <h2>Dein Nickname</h2>
        <p id="display-nick">Lade …</p>
      </article>
    </section>
  </main>

  <script>
    const SUPABASE_URL = "https://YOUR-PROJECT-ref.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Safety: ensure logged in
    async function init() {
      const { data } = await supabase.auth.getUser();
      const user = data.user;
      if (!user) return window.location.href = "index.html";

      // Try to read nickname from metadata, otherwise derive from email local-part
      const metaNick = user.user_metadata?.nickname;
      let shown = metaNick || (user.email ? user.email.split("@")[0] : "Crewmate");
      document.getElementById("display-nick").textContent = shown;
    }

    document.getElementById("logout-btn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "index.html";
    });

    init();
  </script>
</body>
</html>