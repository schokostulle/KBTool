<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dashboard</title>
<style>
body{margin:0;display:flex;background:#19150e;color:#d8c7a0;font-family:Trebuchet MS;height:100vh}
nav{width:220px;background:#231f14;display:flex;flex-direction:column;border-right:1px solid #3b3322}
nav button{background:none;border:none;color:#d8c7a0;padding:14px;text-align:left;cursor:pointer;border-bottom:1px solid #3b3322}
nav button:hover,nav button.active{background:#b9923d;color:#19150e}
main{flex:1;padding:25px;overflow:auto}
h1{color:#b9923d}
</style>
</head>
<body>
<nav>
  <h3 style="text-align:center;color:#b9923d">Bullfrog Tools</h3>
  <button onclick="show('briefing')" class="active">ğŸª¶ Briefing</button>
  <button onclick="show('battle')">âš”ï¸ Kriegsberichte</button>
  <button onclick="show('reserve')">ğŸ“ Reservierung</button>
  <button onclick="show('map')">ğŸ—ºï¸ Karte</button>
  <button class="adminOnly" onclick="show('members')">ğŸ§ Mitglieder</button>
</nav>
<main>
  <section id="briefing"><h1>Willkommen <span id="userDisplay"></span></h1></section>
  <section id="battle" style="display:none"><h1>Kriegsberichte</h1></section>
  <section id="reserve" style="display:none"><h1>Inselreservierung</h1></section>
  <section id="map" style="display:none"><h1>Karte</h1></section>
  <section id="members" style="display:none"><h1>Mitgliederverwaltung</h1><table id="memberTable"></table></section>
</main>

<script type="module">
import { supabase } from "./supabase.js";

const {data:{user}}=await supabase.auth.getUser();
if(!user)window.location="index.html";
const name=localStorage.getItem("username")||"Unbekannt";
const role=localStorage.getItem("role")||"member";
document.getElementById("userDisplay").textContent=name;

/* Sichtbarkeit */
if(role!=="admin")document.querySelectorAll(".adminOnly").forEach(b=>b.style.display="none");
else loadMembers();

/* Navigation */
window.show=id=>{
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  [...document.querySelectorAll("nav button")].find(b=>(b.getAttribute("onclick")||"").includes(id)).classList.add("active");
};

/* Mitgliederliste (Admin) */
async function loadMembers(){
  const {data}=await supabase.from("users").select("*");
  const t=document.getElementById("memberTable");
  t.innerHTML="<tr><th>Name</th><th>Rolle</th><th>Status</th><th>Aktion</th></tr>";
  data.forEach(u=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${u.username}</td><td>${u.role}</td><td>${u.status}</td>
    <td>${u.status==='pending'?`<button onclick="activate('${u.id}')">âœ…</button>`:""}</td>`;
    t.appendChild(tr);
  });
}
window.activate=async(id)=>{await supabase.from("users").update({status:"active"}).eq("id",id);loadMembers();}
</script>
</body>
</html>