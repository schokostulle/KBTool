<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard – Orden der Ersten Seefahrt</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="ocean-bg" aria-hidden="true"></div>
  <main class="dashboard-shell">
    <aside class="sidebar">
      <h2 class="logo">⚓ Crewmenü</h2>
      <nav>
        <ul>
          <li><a href="dashboard.html" class="active">🏠 Übersicht</a></li>
          <li><a href="mitglieder.html">👥 Mitglieder</a></li>
          <li><button id="logout-btn" class="btn small">🚪 Abmelden</button></li>
        </ul>
      </nav>
    </aside>

    <section class="main-content">
      <header>
        <h1>Willkommen an Bord!</h1>
        <p class="subtitle">Nachrichten und Ankündigungen der Flotte</p>
      </header>
      <article id="status"></article>
    </section>
  </main>

  <script>
    const supabase = window.supabase.createClient("https://YOUR-PROJECT-ref.supabase.co","YOUR-ANON-KEY");

    async function init() {
      const { data } = await supabase.auth.getUser();
      if (!data.user) return (window.location.href = "index.html");

      const { data: profile } = await supabase.from("profiles").select("nickname, role, approved").eq("id", data.user.id).maybeSingle();
      const status = document.getElementById("status");

      if (!profile.approved) {
        status.innerHTML = "<h2>⏳ Wartestatus</h2><p>Dein Zugang ist noch nicht freigeschaltet.</p>";
        return;
      }

      status.innerHTML = `<h2>⚔️ Willkommen ${profile.nickname}!</h2><p>Rolle: ${profile.role}</p>`;
    }

    document.getElementById("logout-btn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "index.html";
    });

    init();
  </script>
</body>
</html>