<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Bullfrog Tools Dashboard</title>
<style>

\\ Designzentrale
:root {
  /* === Farbpalette ‚Äì Military Theme === */
  --bg-dark: #19150e;          /* Hintergrund */
  --bg-card: #231f14;          /* Karten / Panels */
  --bg-highlight: #2c261a;     /* Tabellenkopf */
  --border-dark: #3b3322;      /* R√§nder */

  --text-main: #d8c7a0;        /* Standardtext */
  --text-muted: #a8997a;       /* Sekund√§rtext */
  --accent-gold: #b9923d;      /* Hauptakzent (Buttons) */
  --accent-gold-hover: #d1a24f;
  --accent-green: #4CAF50;
  --accent-red: #e74c3c;
  --accent-orange: #ff9f43;
  --accent-gray: #666;
  --accent-gray-hover: #888;

  /* === Schrift & √úberg√§nge === */
  --font-main: "Trebuchet MS", sans-serif;
  --radius: 8px;
  --shadow: 0 0 10px #0006;
  --transition: all 0.3s ease;
}

body{margin:0;display:flex;background:#19150e;color:#d8c7a0;
      font-family:Trebuchet MS;height:100vh}
nav{width:220px;background:#231f14;display:flex;flex-direction:column;
     border-right:1px solid #3b3322}
nav button{background:none;border:none;color:#d8c7a0;padding:14px;
            text-align:left;cursor:pointer;border-bottom:1px solid #3b3322}
nav button:hover,nav button.active{background:#b9923d;color:#19150e}
main{flex:1;padding:25px;overflow:auto;position:relative}
h1{color:#b9923d;margin-top:0}
#logoutBtn{position:absolute;top:15px;right:15px;background:none;border:none;
           font-size:28px;cursor:pointer;color:#b9923d}
#logoutBtn:hover{color:#d1a24f}

/* Tabelle */
table{border-collapse:collapse;width:100%;margin-top:10px}
th,td{padding:8px;border:1px solid #3b3322;text-align:left}
th{background:#2c261a;color:#b9923d}
tr:nth-child(even){background:#1d1912}

/* Buttons */
button.small{border:none;border-radius:4px;padding:4px 8px;margin:0 2px;
             cursor:pointer;font-weight:bold;color:#19150e}
.small.green{background:#4CAF50}.small.green:hover{background:#5ed65e}
.small.red{background:#e74c3c}.small.red:hover{background:#ff6b5c}
.small.gray{background:#666}.small.gray:hover{background:#888}
.small.gold{background:#b9923d;color:#19150e}.small.gold:hover{background:#d1a24f}
.small.orange{background:#ff9f43;color:#19150e}.small.orange:hover{background:#ffb866}

/* Hinweisbox */
#infoBox{position:fixed;bottom:20px;right:20px;background:#b9923d;color:#19150e;
         padding:10px 16px;border-radius:6px;display:none;box-shadow:0 0 10px #0007;
         opacity:0;transition:opacity 0.5s ease}
#infoBox.show{display:block;opacity:1}
</style>
</head>
<body>
<nav>
  <h3 style="text-align:center;color:#b9923d">Bullfrog Tools</h3>
  <button onclick="show('briefing')" class="active">ü™∂ Briefing</button>
  <button onclick="show('battle')">‚öîÔ∏è Kriegsberichte</button>
  <button onclick="show('reserve')">üìç Reservierung</button>
  <button onclick="show('map')">üó∫Ô∏è Karte</button>
  <button class="adminOnly" onclick="show('members')">üßç Mitglieder</button>
</nav>

<main>
  <button id="logoutBtn" title="Zur√ºck ins Lager">üèïÔ∏è</button>

  <section id="briefing"><h1>Willkommen <span id="userDisplay"></span></h1></section>
  <section id="battle" style="display:none"><h1>Kriegsberichte</h1></section>
  <section id="reserve" style="display:none"><h1>Inselreservierung</h1></section>
  <section id="map" style="display:none"><h1>Karte</h1></section>
  <section id="members" style="display:none">
    <h1>Mitgliederverwaltung</h1>
    <table id="memberTable"></table>
  </section>
</main>

<div id="infoBox"></div>

<script type="module">
import { supabase } from "./supabase.js";

/* === Auth pr√ºfen === */
const { data:{ user } } = await supabase.auth.getUser();
if(!user) window.location="index.html";
const currentId=user.id;
const username=localStorage.getItem("username")||"Unbekannt";
const role=localStorage.getItem("role")||"member";
document.getElementById("userDisplay").textContent=username;

/* === Logout === */
document.getElementById("logoutBtn").onclick=async()=>{
  await supabase.auth.signOut();localStorage.clear();window.location="index.html";
};

/* === Sichtbarkeit === */
if(role!=="admin") document.querySelectorAll(".adminOnly").forEach(b=>b.style.display="none");
else loadMembers();

/* === Navigation === */
window.show=id=>{
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  [...document.querySelectorAll("nav button")]
      .find(b=>(b.getAttribute("onclick")||"").includes(id)).classList.add("active");
};

/* === Hinweisbox === */
function showInfo(text,color="#b9923d"){
  const box=document.getElementById("infoBox");
  box.style.background=color;
  box.textContent=text;
  box.classList.add("show");
  setTimeout(()=>{box.classList.remove("show");},7000);
}

/* === Mitgliederverwaltung === */
async function loadMembers(){
  const {data,error}=await supabase.from("users").select("*").order("created_at",{ascending:true});
  if(error){console.error(error);return;}
  const t=document.getElementById("memberTable");
  t.innerHTML="<tr><th>Name</th><th>Rolle</th><th>Status</th><th>Aktion</th></tr>";

  data.forEach(u=>{
    const tr=document.createElement("tr");
    let actions="";
    if(u.status==="pending"){
      actions+=`<button class='small green' onclick="updateStatus('${u.id}','active')">Freigeben</button>`;
      actions+=`<button class='small red' onclick="updateStatus('${u.id}','denied')">Ablehnen</button>`;
    }
    if(u.status==="active"){
      actions+=`<button class='small orange' onclick="updateStatus('${u.id}','blocked')">Blocken</button>`;
    } else if(u.status==="blocked"){
      actions+=`<button class='small green' onclick="updateStatus('${u.id}','active')">Entsperren</button>`;
    }
    if(u.id!==currentId){ // eigener Account gesch√ºtzt
      actions+=`<button class='small gray' onclick="deleteUser('${u.id}')">L√∂schen</button>`;
      if(u.role==="admin")
        actions+=`<button class='small gold' onclick="changeRole('${u.id}','member')">Zu Member</button>`;
      else
        actions+=`<button class='small gold' onclick="changeRole('${u.id}','admin')">Zu Admin</button>`;
    } else { actions+="<em>Eigener Account</em>"; }
    tr.innerHTML=`<td>${u.username}</td><td>${u.role}</td><td>${u.status}</td><td>${actions}</td>`;
    t.appendChild(tr);
  });
}

/* === Aktionen === */
window.updateStatus=async(id,status)=>{
  await supabase.from("users").update({status}).eq("id",id);
  const colors={active:"#4CAF50",denied:"#e74c3c",blocked:"#ff9f43"};
  const msgs={active:"Freigeschaltet",denied:"Abgelehnt",blocked:"Blockiert"};
  showInfo(msgs[status]||"Status ge√§ndert",colors[status]||"#b9923d");
  loadMembers();
};
window.changeRole=async(id,role)=>{
  await supabase.from("users").update({role}).eq("id",id);
  showInfo(role==="admin"?"Bef√∂rdert zu Admin":"Zur√ºckgestuft zu Member","#b9923d");
  loadMembers();
};
window.deleteUser=async(id)=>{
  if(!confirm("Benutzer wirklich l√∂schen?"))return;
  await supabase.from("users").delete().eq("id",id);
  showInfo("Benutzer gel√∂scht","#666");
  loadMembers();
};
</script>
</body>
</html>