<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bullfrog Tools – Dashboard</title>

<style>
:root {
  --bg: #19150e;
  --panel: #231f14;
  --text: #d8c7a0;
  --accent: #b9923d;
}

/* === Grundlayout === */
body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: "Trebuchet MS", sans-serif;
  display: flex;
  flex-direction: row;
  height: 100vh;
  overflow: hidden;
}

/* === Seitenmenü (Desktop/Laptop) === */
nav {
  width: 230px;
  background: var(--panel);
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-right: 1px solid #3b3322;
}

nav h2 {
  text-align: center;
  color: var(--accent);
  margin: 20px 0 15px;
  font-size: 20px;
  letter-spacing: 0.5px;
  border-bottom: 1px solid #3b3322;
  padding-bottom: 10px;
}

nav button {
  background: none;
  border: none;
  color: var(--text);
  padding: 14px 18px;
  text-align: left;
  cursor: pointer;
  border-radius: 0;
  font-size: 15px;
  transition: background 0.2s ease, color 0.2s ease;
  border-bottom: 1px solid #3b3322;
}

nav button:hover,
nav button.active {
  background: var(--accent);
  color: var(--bg);
}

/* === Hauptbereich === */
main {
  flex: 1;
  padding: 25px;
  overflow-y: auto;
}
h1 { color: var(--accent); }
.event {
  background: var(--panel);
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 10px;
}

/* === Tabellen (Platzhalter für künftige Tools) === */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  padding: 8px;
  border-bottom: 1px solid #3b3322;
  text-align: left;
}
th { color: var(--accent); }

/* === Top-Buttons (Theme + Logout) === */
#themeToggle, #logoutBtn {
  position: fixed;
  top: 15px;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--panel);
  border: 1px solid var(--accent);
  color: var(--accent);
  font-size: 20px;
  cursor: pointer;
  z-index: 999;
  box-shadow: 0 0 5px #0006;
}
#themeToggle:hover, #logoutBtn:hover {
  background: var(--accent);
  color: var(--bg);
}
#themeToggle { right: 65px; }
#logoutBtn { right: 15px; }

/* === Lightmode === */
body.light {
  --bg: #e4dfcf;
  --panel: #f2eee4;
  --text: #2a2414;
  --accent: #a1761c;
}

/* === Mobiles Menü (unten) === */
@media (max-width: 768px) {
  body { flex-direction: column; }
  nav {
    flex-direction: row !important;
    justify-content: space-around;
    align-items: center;
    width: 100%;
    height: 60px;
    position: fixed;
    bottom: 0;
    left: 0;
    border-top: 1px solid #3b3322;
    border-right: none;
    z-index: 99;
  }
  nav h2 { display: none; }
  nav button {
    text-align: center;
    flex: 1;
    padding: 8px 0;
    font-size: 14px;
    border-bottom: none;
    border-right: 1px solid #3b3322;
  }
  nav button:last-child { border-right: none; }
  main { padding-bottom: 70px; }
}
</style>
</head>

<body>
<!-- === Schalter === -->
<div id="themeToggle">☀️</div>
<div id="logoutBtn" title="Zurück ins Lager">🏕️</div>

<!-- === Navigationsmenü === -->
<nav>
  <div class="menuTop">
    <h2>Bullfrog Tools</h2>
    <button onclick="showSection('events')" class="active">📜 Ereignisse</button>
    <button onclick="showSection('warreports')">⚔️ Kriegsberichte</button>
    <button onclick="showSection('fleet')">🚢 Flottenstärke</button>
    <button onclick="showSection('reserve')">🏝️ Inselreservierung</button>
    <button onclick="showSection('battle')">🕐 Angriff & Verteidigung</button>
    <button onclick="showSection('map')">🗺️ Karte</button>
    <button onclick="showSection('kbreports')">📖 KB-Datenbank</button>
    <button onclick="showSection('members')" class="adminOnly">🧍 Mitgliederliste</button>
    <button onclick="showSection('diplomacy')" class="adminOnly">🤝 Diplomatie</button>
    <button onclick="showSection('csv')" class="adminOnly">📂 CSV</button>
  </div>
</nav>

<!-- === Hauptinhalt === -->
<main>
  <section id="events">
    <h1>Ereignisse & Informationen</h1>
    <div class="event">Willkommen, <span id="usernameDisplay"></span>!</div>
  </section>

  <section id="warreports" style="display:none;">
    <h1>Kriegsberichte</h1>
    <p>Hier werden Kampfberichte angezeigt oder eingetragen.</p>
  </section>

  <section id="fleet" style="display:none;">
    <h1>Flottenstärke</h1>
    <p>Analyse der militärischen Stärke deiner Allianz.</p>
  </section>

  <section id="reserve" style="display:none;">
    <h1>Inselreservierung</h1>
    <p>Reserviere Inseln, um Angriffsziele zu koordinieren.</p>
  </section>

  <section id="battle" style="display:none;">
    <h1>Angriff & Verteidigung</h1>
    <p>Berechnung von Zeiten, Entfernungen und Taktiken.</p>
  </section>

  <section id="map" style="display:none;">
    <h1>Karte</h1>
    <p>Visualisierung der Inselwelt mit Allianzfarben.</p>
  </section>

  <section id="kbreports" style="display:none;">
    <h1>KB-Datenbank</h1>
    <p>Speicherung und Auswertung vergangener Kämpfe.</p>
  </section>

  <!-- Admin only -->
  <section id="members" style="display:none;">
    <h1>Mitgliederliste</h1>
    <table id="memberTable"></table>
  </section>

  <section id="diplomacy" style="display:none;">
    <h1>Diplomatie</h1>
    <p>Verwaltung befreundeter oder feindlicher Allianzen.</p>
  </section>

  <section id="csv" style="display:none;">
    <h1>CSV-Daten</h1>
    <p>Import und Verwaltung der Spielbasisdaten (nur Admin).</p>
  </section>
</main>

<script type="module">
import { supabase } from "./supabase.js";

/* === Auth prüfen === */
const { data: { user } } = await supabase.auth.getUser();
if (!user) window.location.href = "index.html";
const username = localStorage.getItem("username") || "";
const role = localStorage.getItem("role") || "member";
document.getElementById("usernameDisplay").textContent = username;

/* === Theme === */
const themeBtn = document.getElementById("themeToggle");
const setTheme = (m) => {
  if (m === "light") {
    document.body.classList.add("light");
    themeBtn.textContent = "🌙";
  } else {
    document.body.classList.remove("light");
    themeBtn.textContent = "☀️";
  }
  localStorage.setItem("theme", m);
};
setTheme(localStorage.getItem("theme") || "dark");
themeBtn.onclick = () =>
  setTheme(document.body.classList.contains("light") ? "dark" : "light");

/* === Logout === */
document.getElementById("logoutBtn").onclick = async () => {
  await supabase.auth.signOut();
  localStorage.clear();
  window.location.href = "index.html";
};

/* === Navigation === */
window.showSection = (id) => {
  document.querySelectorAll("main section").forEach((s) => (s.style.display = "none"));
  document.getElementById(id).style.display = "block";
  document.querySelectorAll("nav button").forEach((b) => b.classList.remove("active"));
  const activeBtn = [...document.querySelectorAll("nav button")].find((b) =>
    (b.getAttribute("onclick") || "").includes(id)
  );
  if (activeBtn) activeBtn.classList.add("active");
};

/* === Adminsicht === */
if (role !== "admin") {
  document.querySelectorAll(".adminOnly").forEach((b) => (b.style.display = "none"));
} else {
  loadMembers();
}

/* === Mitgliederliste (Admin) === */
async function loadMembers() {
  const { data: users, error } = await supabase.from("users").select("*");
  const t = document.getElementById("memberTable");
  if (error) {
    t.innerHTML = "<tr><td>Fehler: " + error.message + "</td></tr>";
    return;
  }
  t.innerHTML = "<tr><th>Name</th><th>Rolle</th><th>Status</th><th>Aktion</th></tr>";
  users.forEach((u) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.username}</td>
      <td>${u.role}</td>
      <td>${u.status}</td>
      <td>
        ${u.status === "pending" ? `<button class='action-btn' onclick="activate('${u.id}')">✅</button>` : ""}
        <button class='action-btn' onclick="blockUser('${u.id}')">⛔</button>
        <button class='action-btn' onclick="deleteUser('${u.id}')">🗑️</button>
      </td>`;
    t.appendChild(tr);
  });
}

window.activate = async (id) => { await supabase.from("users").update({ status: "active" }).eq("id", id); loadMembers(); };
window.blockUser = async (id) => { await supabase.from("users").update({ status: "blocked" }).eq("id", id); loadMembers(); };
window.deleteUser = async (id) => { await supabase.from("users").delete().eq("id", id); loadMembers(); };
</script>
</body>
</html>