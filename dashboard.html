<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bullfrog Command Dashboard</title>
  <link rel="stylesheet" href="./css/stylesheet.css" />
</head>

<body class="dark-theme">
  <header class="header">
    <h1>⚓ Bullfrog Command</h1>
    <nav>
      <button id="logoutBtn" class="nav-btn">🚪 Logout</button>
    </nav>
  </header>

  <main>
    <!-- ========================== -->
    <!-- 🧭 Dashboard Startbereich -->
    <!-- ========================== -->
    <section class="dashboard-intro">
      <h2>Willkommen, <span id="username">Kommandant</span>!</h2>
      <p>Dies ist dein Hauptquartier. Wähle ein Tool oder öffne den Adminbereich (falls du berechtigt bist).</p>
    </section>

    <!-- ========================== -->
    <!-- 🧰 Beispiel-Tools -->
    <!-- ========================== -->
    <section class="tools-grid">
      <div class="tool-card" onclick="window.location.href='./fleet.html'">
        ⚔️ <strong>Flottenplanung</strong><br>
        <small>Strategische Übersicht deiner Fregatten</small>
      </div>

      <div class="tool-card" onclick="window.location.href='./resources.html'">
        🪓 <strong>Ressourcenverwaltung</strong><br>
        <small>Verteilung von Holz, Eisen und Steinen</small>
      </div>

      <div class="tool-card" onclick="window.location.href='./battlemap.html'">
        🗺️ <strong>Kriegsgebiete</strong><br>
        <small>Schlachtfelder & Allianzen</small>
      </div>
    </section>

    <!-- ========================== -->
    <!-- 👑 ADMIN-BEREICH -->
    <!-- ========================== -->
    <section id="admin-members" class="admin-section hidden">
      <h2 class="section-title">👑 Mitgliederverwaltung</h2>

      <div id="infoBox" class="info-box hidden"></div>

      <div class="admin-toolbar">
        <input type="text" id="memberSearch" placeholder="🔍 Mitglieder suchen..." />
        <select id="roleFilter">
          <option value="all">Alle Rollen</option>
          <option value="admin">Admin</option>
          <option value="member">Mitglied</option>
          <option value="applicant">Anwärter</option>
          <option value="banned">Gesperrt</option>
        </select>
        <button id="refreshMembers">🔄 Aktualisieren</button>
      </div>

      <div id="membersContainer" class="members-grid"></div>
    </section>
  </main>

  <footer class="footer">
    <p>⚓ Bullfrog Fleet Command – Gemeinschaft der Seefahrer</p>
  </footer>

  <!-- ========================== -->
  <!-- 🔗 SCRIPTS -->
  <!-- ========================== -->
  <script type="module" src="./js/supabase.js"></script>
  <script type="module">
    import { supabase } from './js/supabase.js';

    const logoutBtn = document.getElementById('logoutBtn');
    const usernameEl = document.getElementById('username');
    const adminSection = document.getElementById('admin-members');

    async function loadUser() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) {
        window.location.href = './index.html';
        return;
      }

      // Profil laden
      const { data: profile } = await supabase
        .from('profiles')
        .select('username, role')
        .eq('id', user.id)
        .single();

      usernameEl.textContent = profile?.username || 'Kommandant';

      // Adminbereich sichtbar machen
      if (profile?.role === 'admin') {
        adminSection.classList.remove('hidden');
      }
    }

    logoutBtn.addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = './index.html';
    });

    loadUser();
  </script>

  <!-- Adminmodul -->
  <script type="module" src="./js/members.js"></script>
</body>
</html>