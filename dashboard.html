<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bullfrog Tools – Dashboard</title>
<style>
  :root {
    --bg:#19150e;--panel:#231f14;--text:#d8c7a0;--accent:#b9923d;
  }
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:"Trebuchet MS",sans-serif;display:flex;height:100vh;overflow:hidden;
  }
  nav{
    width:230px;background:var(--panel);display:flex;flex-direction:column;
    justify-content:space-between;border-right:1px solid #3b3322;
  }
  nav h2{text-align:center;color:var(--accent);}
  nav button{
    background:none;border:none;color:var(--text);
    padding:12px 14px;text-align:left;cursor:pointer;border-radius:6px;
  }
  nav button:hover,nav button.active{background:var(--accent);color:var(--bg);}
  main{flex:1;padding:25px;overflow-y:auto;}
  h1{color:var(--accent);}
  .event{background:var(--panel);padding:15px;border-radius:8px;margin-bottom:10px;}
  #themeToggle,#logoutBtn{
    position:fixed;top:15px;width:42px;height:42px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    background:var(--panel);border:1px solid var(--accent);color:var(--accent);
    cursor:pointer;z-index:50;
  }
  #themeToggle{right:65px;}#logoutBtn{right:15px;}
  #logoutBtn:hover,#themeToggle:hover{background:var(--accent);color:var(--bg);}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{padding:8px;border-bottom:1px solid #3b3322;text-align:left;}
  th{color:var(--accent);}
  @media(max-width:768px){nav{display:none;}}
</style>
</head>
<body>
  <div id="themeToggle">☀️</div>
  <div id="logoutBtn">🏕️</div>

  <nav>
    <div>
      <h2>Bullfrog Tools</h2>
      <button onclick="showSection('events')" class="active">📜 Ereignisse</button>
      <button onclick="showSection('members')">🧍 Mitglieder</button>
    </div>
    <button onclick="logout()">🏕️ Abmelden</button>
  </nav>

  <main>
    <section id="events">
      <h1>Ereignisse</h1>
      <div class="event">Willkommen, <span id="usernameDisplay"></span>!</div>
    </section>

    <section id="members" style="display:none;">
      <h1>Mitgliederverwaltung</h1>
      <table id="memberTable"></table>
    </section>
  </main>

  <script type="module">
    import { supabase } from "./supabase.js";

    // Session prüfen
    const { data:{ user } } = await supabase.auth.getUser();
    if(!user) window.location.href="index.html";

    const username=localStorage.getItem("username")||"";
    const role=localStorage.getItem("role")||"member";
    document.getElementById("usernameDisplay").textContent=username;

    // Theme Schalter
    const themeBtn=document.getElementById("themeToggle");
    const setTheme=(m)=>{
      if(m==="light"){document.body.classList.add("light");themeBtn.textContent="🌙";}
      else{document.body.classList.remove("light");themeBtn.textContent="☀️";}
      localStorage.setItem("theme",m);
    };
    const saved=localStorage.getItem("theme")||"dark";
    setTheme(saved);
    themeBtn.onclick=()=>setTheme(document.body.classList.contains("light")?"dark":"light");

    // Logout
    window.logout=async()=>{
      await supabase.auth.signOut();
      localStorage.clear();
      window.location.href="index.html";
    };
    document.getElementById("logoutBtn").onclick=logout;

    // Navigation
    window.showSection=(id)=>{
      document.querySelectorAll("main section").forEach(s=>s.style.display="none");
      document.getElementById(id).style.display="block";
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      const activeBtn=[...document.querySelectorAll("nav button")].find(b=>b.getAttribute("onclick").includes(id));
      if(activeBtn) activeBtn.classList.add("active");
    };

    // Nur Admins sehen Mitgliederverwaltung
    if(role!=="admin"){
      document.querySelector('button[onclick*="members"]').style.display="none";
    } else {
      loadMembers();
    }

    async function loadMembers(){
      const {data:users}=await supabase.from("users").select("*");
      const t=document.getElementById("memberTable");
      t.innerHTML="<tr><th>Name</th><th>Rolle</th><th>Status</th><th>Aktion</th></tr>";
      users.forEach(u=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${u.username}</td>
          <td>${u.role}</td>
          <td>${u.status}</td>
          <td>
            ${u.status==="pending" ? `<button onclick="activate('${u.id}')">✅ Freischalten</button>` : ""}
            <button onclick="blockUser('${u.id}')">⛔ Sperren</button>
            <button onclick="deleteUser('${u.id}')">🗑️ Löschen</button>
          </td>`;
        t.appendChild(tr);
      });
    }

    window.activate=async(id)=>{await supabase.from("users").update({status:"active"}).eq("id",id);loadMembers();};
    window.blockUser=async(id)=>{await supabase.from("users").update({status:"blocked"}).eq("id",id);loadMembers();};
    window.deleteUser=async(id)=>{await supabase.from("users").delete().eq("id",id);loadMembers();};
  </script>
</body>
</html>